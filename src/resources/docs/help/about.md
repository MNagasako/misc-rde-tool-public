# ARIM RDE Tool について

## アプリ概要

**ARIM RDE Tool** は DICE/RDE システムと ARIM データポータルを統合的に操作するためのデスクトップアプリケーションです。RDE からの情報取得、ポータルへの登録、AI を用いたテキスト支援、診断ツール群など、日常業務をまとめてカバーします。

- **現在のバージョン**: v2.4.4
- **最終更新日**: 2026-01-04
- **対応 OS**: Windows 10 / 11 (FHD 1920×1080 推奨)

## 主な機能

### 🔐 認証・セッション管理
- PySide6 WebView による統合ログイン UI
- OAuth2 RefreshToken の自動更新 (60 秒監視 / 5 分前マージン)
- RDE / Material API のトークンを同時管理
- トークン状態タブで有効期限や残り時間を可視化

### 📊 基本情報・データ取得
- 課題番号単位の基本情報取得と JSON 永続化
- まとめ XLSX / 反映 XLSX の 2 系統レポート出力
- 並列ダウンロードとファイル単位プログレス表示
- groupOrganizations・subGroups データの完全性チェック

### 🤖 AI / 自動化
- データセット説明文の AI 提案とプロンプト編集
- ファイル内容の自動テキスト抽出 (Excel / CSV / JSON 等)
- 構造化 JSON を用いた AI テンプレート／装置チャンク連携

### 🌐 ネットワークと診断
- DIRECT / MANUAL / SOCKS5 / PAC / 自動検出モード
- truststore を利用した企業 CA / SSL 証明書統合
- 6 種類のプロキシ診断スクリプト＋統合ランナー
- MitM (Fiddler など) 環境での検証ユーティリティ

### 🎨 UI / UX
- ライト / ダークテーマ切り替え (OS テーマと連動)
- 標準ウインドウ枠のカラー連動 (Windows immersive dark mode)
- メニュー / ボタン / プログレスバーの統一スタイル
- Markdown で記述したヘルプドキュメントをそのまま表示

## v2.4.4 の主な更新点

| 分類 | 内容 |
| --- | --- |
| データ取得2 | メール通知タブ: 対象通知リストのフィルタを自動通知の送信対象にも適用（表示されていないものは送信しない）。 |
| データ取得2 | メール通知タブ: 「通知対象抽出」で最新情報取得も同時に行うオプションを追加。 |
| データ取得2 | メール通知タブ: 基準日時に「自動（現在）/直接指定」モードを追加。 |
| データ取得2 | メール通知タブ: 削除テンプレが再起動で復活する不具合を抑止。 |

## v2.4.3 の主な更新点

| 分類 | 内容 |
| --- | --- |
| データ取得2 | メール通知タブの運用を改善（運用モード表示の簡略化、本番送信先に設備管理者を追加）。 |

## v2.4.2 の主な更新点

| 分類 | 内容 |
| --- | --- |
| データ取得2 | メール通知タブを拡張（テンプレ編集の分離、宛先選択の明確化、送信ログ運用の改善、設備管理者プレースホルダ対応）。 |
| 設備 | 設備管理者（設備IDごと）の編集・永続化UIを追加し、装置名フォールバック補完と表示不具合を修正。 |

## v2.4.1 の主な更新点

| 分類 | 内容 |
| --- | --- |
| データ取得2 | メール通知タブを改善（運用モード: テスト/本番、送信先: 投入者/所有者/両方、抽出範囲プリセット、送信ログ閲覧）。 |
| メール | Gmail/SMTPのFrom表示名（任意）を追加し、送信ヘッダへ反映。 |

## v2.4.0 の主な更新点

| 分類 | 内容 |
| --- | --- |
| データ登録 | 「登録状況」タブを拡張し、自動確認（10秒ポーリング）・進捗可視化・停止トグル・リンク列縮小・水平スクロール対応・追加列（投入者/所有者/エラー情報）を実装。 |
| パフォーマンス | 大量行でも固まりにくいよう、キャッシュ読込の非同期化とセルクリック方式へ最適化。 |
| UI/UX | 登録状況タブで発生していたウィンドウ固定幅化を解消し、リサイズ可能に修正。 |

## v2.3.16 の主な更新点

| 分類 | 内容 |
| --- | --- |
| データセット | データエントリー一覧から送り状（invoice）の編集を行い、RDE API へ PATCH 反映できるように改善。データ所有者(所属)の選択・試料モード（前回/既存ID/新規）を追加。 |
| UI/UX | 編集ダイアログをスクロール対応にし、初期サイズを画面比率（幅50%/高さ80%）へ最適化。基本情報/試料情報の2列レイアウト化とテキストエリア高さ調整で縦長を抑制。 |
| テスト/品質 | 既存フルスイートで回帰がないことを確認。 |

## v2.3.15 の主な更新点

| 分類 | 内容 |
| --- | --- |
| AI | AI説明文提案に「データセット」タブを追加し、コンボ選択から「一覧テーブル選択 + 列別フィルタ」へ移行。報告書タブ同様の一括/並列問い合わせにも対応。 |
| AI | 結果一覧から開くログ表示ダイアログで、JSONログを「ツリー表示 / 全文表示」で切り替え可能にし、「標準テキストエディタで開く」ボタンを追加。 |
| テスト/品質 | pytest実行時のテーマ切替コストを抑制し、長時間スイートでのタイムアウト発生を低減。 |

## v2.3.14 の主な更新点

| 分類 | 内容 |
| --- | --- |
| UI/テーマ | ウィジェット切替時に低頻度で発生する「意図しない黒い領域」を抑止するため、`QScrollArea` の viewport 背景へテーマ色を直接適用する仕組みを追加。 |
| データ整合性 | RDE 側で削除済み（404/410）と確定したデータセット/サブグループIDをローカルに記録し、候補コンボから除外（ローカルJSONとの乖離によるサーバエラー誘発を防止）。 |
| テスト/品質 | pytest 実行時にモーダル警告やネットワークアクセスで固まらないようにガードを整備し、`unittest.mock` 依存など規約違反を解消。 |

## v2.3.13 の主な更新点

| 分類 | 内容 |
| --- | --- |
| 設定 | 対応ファイル形式(XLSX)の解析で、テンプレートID/名の取得を「行単位の最新版（値が入っている最大Vn）選択」へ改善（V6/V7混在に対応）。 |
| テスト | V6/V7混在ケースのユニットテストを追加し、回帰を防止。 |

## v2.3.12 の主な更新点

| 分類 | 内容 |
| --- | --- |
| AI | AI説明文提案（結果一覧）で、行クリックから対応ログを表示できるよう改善（JSONはキー/値対応、テキストはそのまま表示）。 |
| AI | 対象=報告書の場合、「重要技術領域（主/副）」が欠損(nan)のときは空値表示に正規化。 |
| テスト | 結果一覧ログビューア（JSON/テキスト）と、重要技術領域の欠損表示（nan→空値）のウィジェットテストを追加。 |

## v2.3.11 の主な更新点

| 分類 | 内容 |
| --- | --- |
| AI | Gemini のモデル/デフォルトモデルを認証方式（API Key / Vertex SA）ごとに保存・選択できるよう改善。APIキー無しでも公式ページ解析でモデル候補を取得できるフォールバックを追加。 |
| テスト | データ登録（通常登録）の検証表示統合テストを headless で安定実行できる形に見直し、skip を解消。 |

## v2.3.10 の主な更新点

| 分類 | 内容 |
| --- | --- |
| AI | AI説明文提案の「結果一覧」（対象=報告書）で、ARIM課題番号で結合した「重要技術領域（主/副）」を列追加表示。 |
| テスト | 報告書タブ/結果一覧タブのウィジェットテストが実データやキャッシュに依存しないよう決定性を改善。 |

## v2.3.9 の主な更新点

| 分類 | 内容 |
| --- | --- |
| テスト | 長時間のpytest実行で発生しうる「破棄済みQtオブジェクト参照」起因の不安定化を抑制（destroyed時のdisconnect/弱参照化/生存チェック）。 |
| テスト | Windowsでのウィジェットテストがネイティブウィンドウ資源に影響されにくいよう調整し、フルスイート完走性を改善。 |
| UI/テーマ | テーマ切替イベントが破棄後に呼ばれないよう接続管理を整理し、テスト/通常実行の両方で安定化。 |
| ドキュメント | README/ヘルプ/配布物のバージョン表記を v2.3.9 に更新。 |

## v2.3.8 の主な更新点

| 分類 | 内容 |
| --- | --- |
| テスト | Windows/Qt環境で稀に発生する 0x8001010d 系のクラッシュ/ノイズ要因を抑制し、フルスイートの安定実行を改善。 |
| テスト | `sys.modules` 直書きによるモジュール汚染を解消し、後続テストでの ImportError を防止。 |
| UI/テーマ | pytest実行時のテーマ切替でイベント処理が原因の不安定化が起きないように調整（通常実行の挙動は維持）。 |
| ドキュメント | README/ヘルプ/配布物のバージョン表記を v2.3.8 に更新。 |

## v2.3.7 の主な更新点

| 分類 | 内容 |
| --- | --- |
| AI | Gemini で `finishReason=MAX_TOKENS` かつ本文が欠落するケースに対して `maxOutputTokens` を自動増量して再試行し、失敗を抑制。 |
| AI | 実リクエスト/レスポンスの本文以外パラメータを可視化し、デバッグ性を向上。 |
| ネットワーク | 設定タブの外部疎通で `verify=False` を強制しないよう統一し、truststore/CA設定に追従。 |
| UI/テーマ/パス | 一部のハードコード色と `__file__` 依存を解消し、規約準拠を改善。 |
| ドキュメント | README/ヘルプ/バージョン表記を v2.3.7 に更新。 |

## v2.3.6 の主な更新点

| 分類 | 内容 |
| --- | --- |
| データ登録 | 通常登録の必須未入力時UXを改善（押下は可能・未入力表示・アラートで促す）。 |
| データ登録 | 完了ダイアログの挙動を分離：通常登録は「確認」押下まで保持、一括登録は確認回数を減らすため自動クローズ寄り。 |
| テスト | 通常/一括それぞれの完了ダイアログ挙動をウィジェットテストで検証。 |
| ドキュメント | README/ヘルプ/リリースノートを v2.3.6 に更新。 |

## v2.3.5 の主な更新点

| 分類 | 内容 |
| --- | --- |
| テスト | 外部依存（WebEngine/モーダル）に左右されにくい形へテストを再設計し、安定実行を改善。 |
| UI | 成功/失敗など一部のハードコード色をテーマキー参照に移行し、ライト/ダークでの一貫性を改善。 |
| 診断 | 診断ランナーの `sys.path` 依存を減らし、環境汚染を避ける方式へ改善。 |
| ドキュメント | README/ヘルプ/リリースノートを v2.3.5 に更新。 |

## v2.3.4 の主な更新点

| 分類 | 内容 |
| --- | --- |
| データポータル | 「データカタログ修正」: 装置・プロセス領域に機能列（関連カタログ）を追加。 |
| データポータル | dataset detail JSON + 公開JSONから関連カタログリンクHTMLを生成し、見出しテキスト/タグも編集可能に。 |
| テスト | xfail/xpass整理と、ダイアログ/スレッドのスタブ化でフレークを抑制。 |
| ドキュメント | README/ヘルプ/リリースノートを v2.3.4 に更新。 |

## v2.3.3 の主な更新点

| 分類 | 内容 |
| --- | --- |
| データセット修正 | 関連データセット設定（ビルダーダイアログ）の操作性/安定性を改善。 |
| データセット修正 | 選択件数が1件（index=0）の場合に未選択扱いになる不具合を修正。 |
| テスト | 実装に合わせてウィジェットテストを更新し、外部依存（ネットワーク/モーダル）由来のフレークを抑制。 |
| ドキュメント | README/ヘルプ/リリースノートを v2.3.3 に更新。 |

## v2.3.2 の主な更新点

| 分類 | 内容 |
| --- | --- |
| UI | テキストエリア（説明欄など）の枠線/背景が見えにくい問題を改善。 |
| テスト | 枠線/背景のピクセル検証ウィジェットテストを追加・強化し、回帰を防止。 |
| ドキュメント | README/ヘルプ/リリースノートを v2.3.2 に更新。 |

## v2.3.1 の主な更新点

| 分類 | 内容 |
| --- | --- |
| データセット | 更新直後にAPIから個別詳細JSONを再取得し、キャッシュの古さによる表示不整合を抑制。 |
| データセット | 編集タブのデータセット選択コンボボックスで、カーソルキー/ホイールでの選択操作を改善。 |
| データセット | コンボボックスのアイテム管理を修正し、候補が空になるケースを抑制。 |
| ドキュメント | README/ヘルプ/リリースノートを v2.3.1 に更新。 |

## v2.3.0 の主な更新点

| 分類 | 内容 |
| --- | --- |
| ログイン | 固定sleep依存を廃止し、トークン出現を条件に待機（バックオフ+総タイムアウト）して自動ログインを安定化。 |
| ログイン | 自動ログイン時のみ、RefreshTokenがあればフォールバックでアクセストークン再取得を試行。 |
| テスト | pytest実行時の外部HTTP依存を抑制し、オフライン環境でもテストスイートが完走できるように調整。 |
| ドキュメント | README/ヘルプ/リリースノートを v2.3.0 に更新し、旧リリースノートを `doc_archives/release_notes_v2.2.x/` へ退避。 |

## v2.2.7 の主な更新点

| 分類 | 内容 |
| --- | --- |
| テスト | pytest実行時のみ、ネイティブUI操作（ダイアログ/可視化/強制processEvents等）を抑制し、0x8001010d 系の致命的クラッシュを回避。 |
| 基本情報 | invoiceSchema取得時はteamId候補のうち最初の候補のみを使用し、失敗しても他の候補を試行しないように変更。 |
| バージョン | REVISION/VERSION.txt/README/ヘルプ/配布物の表記を v2.2.7 に統一し、旧リリースノートを `doc_archives/release_notes_v2.2.x/` へ退避。 |

## v2.2.6 の主な更新点

| 分類 | 内容 |
| --- | --- |
| データポータル | データセットアップロード画面の取得済み画像一覧を4列テーブル化し、キャプション編集・ヘッダ固定・ソート・アップ済み表示に対応。 |
| データセット | TAGビルダーに「AI提案」タブを追加し、候補生成→採用/全て採用、リトライ提案、プロンプト/回答全文確認を実装。 |
| バージョン | REVISION/VERSION.txt/README/ヘルプ/配布物の表記を v2.2.6 に統一し、旧リリースノートを `doc_archives/release_notes_v2.2.x/` へ退避。 |

## v2.2.5 の主な更新点

| 分類 | 内容 |
| --- | --- |
| AIサジェスト | 管理ダイアログのリスト再描画を刷新し、再読込時にスペーサ破棄と内部リストの再初期化を行うことで「AI拡張設定の読み込みエラー」を根絶。 |
| テスト | `test_extension_buttons_reload_without_error` を追加し、設定保存後の再読込でボタン数・状態が完全に再構築されることをQtウィジェットテストで保証。 |
| ドキュメント | README / readme.txt / LICENSE-dist.txt / ヘルプ群 / セットアップスクリプトを v2.2.5 へ更新し、v2.2.4 リリースノートを `doc_archives/release_notes_v2.2.x/` へ退避。 |

## v2.2.4 の主な更新点

| 分類 | 内容 |
| --- | --- |
| UI | Equipment/Reports 各タブにフィルタ可能な Listing テーブルを追加し、最新JSONの再読込・件数表示・ツールチップ展開を実装 |
| Reports | ReportCacheManager/Mode を導入し、取得済みレポートのキャッシュ再利用と強制再取得をUIから切り替え可能に |
| Basic Info | `BasicInfoSearchDialog` で自分のデータセット/キーワード/機関ID+年度レンジの3モード検索を統合し、バッチ生成を高速化 |
| Equipment | FacilityListingScraper による全件ID収集と連続不在検知を実装し、設備JSON欠損の自動検出と再取得連携を強化 |

## 技術スタック

- **言語**: Python 3.13.5
- **UI**: PySide6 / QtWebEngine
- **HTTP**: `net.http_helpers` (requests + truststore)
- **データ処理**: pandas / openpyxl / numpy
- **ビルド**: PyInstaller (onedir / withtest プロファイル)

## プロジェクト体制

- **開発**: 個人開発 (MNagasako)
- **リポジトリ**: [MNagasako/misc-rde-access](https://github.com/MNagasako/misc-rde-access)

### 問い合わせ

1. アプリ右上のログ出力ボタンから `output/log/` を開き、問題の前後ログを確認してください。
2. 不具合や要望は GitHub Issues へ。再現手順・ログ・スクリーンショットの添付を推奨します。

---

このヘルプは `src/resources/docs/help/about.md` を直接編集することで即時反映されます。ビルド後も PyInstaller バンドルへ同梱されます。