# ARIM RDE Tool (配布用リポジトリ)

[![Release](https://img.shields.io/github/v/release/MNagasako/misc-rde-tool-public)](https://github.com/MNagasako/misc-rde-tool-public/releases)
[![License: LGPL v3](https://img.shields.io/badge/License-LGPL_v3-blue.svg)](https://www.gnu.org/licenses/lgpl-3.0)

**ARIM事業 RDE→ARIMデータポータル移行ツール v2.2.0** のバイナリ配布およびドキュメント公開用リポジトリです。

> ⚠ 本ツールは単独の個人開発による非公式ツールです。ARIM事業 / RDE / ARIMデータポータルの公式サポート対象ではありません。開発チーム・ロードマップ・将来計画の事前告知は一切行いません。ここに記載しているのは現行バージョンで提供中の機能のみです。
> RDEサイトおよびデータポータルの画面・通信挙動を独自解析し再現しているため、サイト側の仕様変更で予告なく動作しなくなる・誤作動する可能性があります。利用は自己責任で行ってください。

本ツールは、文部科学省ARIM事業の研究データ共有サイト「RDE」の操作補助とデータポータルへの登録支援を目的とした Windows デスクトップアプリケーションです。Web操作の煩雑さを軽減し、データの一括取得・登録・AI支援機能を提供します。

---

## 🚀 最新情報

**2025-12-06 最新リリース**: バージョン2.2.0（包括的改善リリース）

### v2.2.0 の主な改善

- 基本情報タブの完全性チェックを強化し、進捗表示と並列化を最適化
- AI機能の安定化（`llm_model_name` プレースホルダ置換の完全対応、AI CHECK のリトライ/タイムアウト調整）
- データセット管理の操作性向上（関連データ/情報ビルダーダイアログの改善、日時表示をJSTに統一）
- 設定・ネットワーク・CLIの強化（暗号化保存維持、ログレベル指定の整理、truststore対応継続）

---
**[クイックスタート(書きかけ)](https://cuddly-stinger-40d.notion.site/QuickStart-2befc2cb5fc380f09d0dd4595b767f4d?source=copy_link)**

## 📥 ダウンロードとインストール

### 推奨: インストーラーを使用する
最も簡単な方法です。Python環境は不要です。

1. **[Releases ページ](https://github.com/MNagasako/misc-rde-tool-public/releases)** から最新の `arim_rde_tool_setup.exe` をダウンロードしてください。
2. ダウンロードしたファイルを実行し、ウィザードに従ってインストールします。
3. デスクトップに作成されたショートカットからアプリを起動します。
4. 初回起動時、必要なフォルダ（`input/`, `output/`）が自動的に作成されます。

#### 最新版バイナリへの直接リンク

常に最新の安定版: https://github.com/MNagasako/misc-rde-tool-public/releases/latest

過去バージョンを含む全一覧: https://github.com/MNagasako/misc-rde-tool-public/releases

### 上級者向け: Python環境で実行する
ソースコードから直接実行することも可能です。

* **動作環境**: Windows 10/11 64bit, Python 3.13+
* **手順**:
    1. リポジトリをクローンまたはダウンロードします。
    2. 仮想環境を作成し、依存パッケージをインストールします。
       ```powershell
       python -m venv .venv
       ./.venv/Scripts/Activate
       pip install -r src/requirements.txt
       ```
    3. アプリケーションを起動します。
       ```powershell
       python src/arim_rde_tool.py
       ```

#### PyInstaller による単一ファイル EXE の再生成（参考）
ドキュメント: `docs/binary_build_notes.md` を参照（開発者向け）。

```powershell
pyinstaller arim_rde_tool.spec --clean --noconfirm
```

生成物例: `dist/arim_rde_tool.exe`

---


> **暫定マニュアル（Notion）**
> 開発中の最新情報や補足事項は [こちらのNotionページ](https://cuddly-stinger-40d.notion.site/v2-0-0-2a4fc2cb5fc380978d95fbd07c6fa37e?pvs=74) も参照してください。

---


### 初回起動時の警告

Windowsのセキュリティ警告やアンチウイルスによりブロックされる場合は、環境に応じて例外設定を行ってください。

<img width="532" height="498" alt="2025-07-31_18h22_53" src="https://github.com/user-attachments/assets/5117baeb-973c-4a7d-aed6-8f2d58400f26" />
<img width="532" height="498" alt="2025-07-31_18h23_02" src="https://github.com/user-attachments/assets/56e2ecce-466c-420e-ba84-95fc0eceacb5" />

## 使い方

### 0. 設定

<img width="1062" height="1004" alt="2025-09-17_11h16_05" src="https://github.com/user-attachments/assets/0991e17a-62aa-461d-bc64-8983c694b384" />
<img width="1062" height="1004" alt="2025-09-17_11h17_17" src="https://github.com/user-attachments/assets/65baed9c-e52e-4cb6-9999-5ac6ad100267" />

* 環境に応じてプロキシ設定を行ってください。通常のブラウザでインターネットアクセスできていれば本ツールも使用可能です（認証付きプロキシは未対応）

> **自動ログイン設定について**
>
> * 「暗号化ファイル」または「OSキーチェーン」への保存を推奨（設定メニューで選択可能）
>
> * `input/login.txt` への平文保存は **非推奨**。やむを得ず利用する場合は以下形式（ICE のみ）
>
>   ```txt
>   username(mail)
>   password
>   dice
>   ```
>
> * login.txt 利用時は毎回警告が表示されます。できるだけ安全な保存方法へ移行してください

> **自動ログイン設定後、アプリを再起動してください。**

### 1. 基本情報

**データ取得・事前準備** <img width="1062" height="925" alt="2025-08-22_13h50_22" src="https://github.com/user-attachments/assets/bb481a4b-3585-409e-bad3-1941694ee20d" />

* RDEサーバ上のデータをローカルに一括取得し、検索機能を有効化します
* 初回は時間を要しますが、既存ファイルはスキップされます
* 強制再取得が必要な場合は対象ファイルを削除して再実行してください
* 初回は20～30分かかる場合があります。短縮したい場合は「基本情報取得（検索用）」で課題番号プリフィックス等により絞り込みを推奨。既存データはスキップされます

1. **基本情報取得（API または 検索用）** を実行
2. **サンプル情報強制取得** を実行
3. **invoice_schema 取得** を実行

### 2. データ取得（旧方式）

* 従来の **WebView** を用いて RDE の画面にアクセスし、BLOB 画像を保存する実装です。パフォーマンス上の制限があり、環境によっては取得に時間がかかります
* 後述の **新方式（API直接ダウンロード）** の利用を推奨します

1. **ARIM課題番号** を指定
2. **実行ボタン** をクリックすると、関連するデータセットと、それに紐付いた **データエントリー（タイル）** の情報を取得します
3. **保存フォルダを開く** ボタンで、保存フォルダを開けます

### 3. データ取得2（新方式）

<img width="1062" height="632" alt="2025-09-17_11h08_48" src="https://github.com/user-attachments/assets/4d1ff881-9c61-4673-acd3-a22f1ca4b1b3" />
<img width="1062" height="632" alt="2025-09-17_11h08_58" src="https://github.com/user-attachments/assets/6865cdfe-dd10-400e-8c0d-30597bb85712" />

* **APIアクセスで直接ダウンロード** する方式です。旧方式に比べて速度の面で有利です
* **データセット単位** でダウンロードします

#### データ取得

1. コンボボックスで対象データセットを選択（フィルタリング・補完検索可能）
2. **選択データセットのファイルを一括取得** をクリックで書誌情報・画像をまとめて取得
3. **出力フォルダ（DataFiles）をエクスプローラーで開く** ボタンで、保存フォルダを開けます

#### ファイルフィルタ

* ファイルタイプ・メディアタイプ・拡張子・サイズ・名称・上限数でダウンロードするファイルを指定できます
* フィルタを指定してからデータ取得タブで一括取得を実行してください

### 4. サブグループ（研究グループ）
<img width="1062" height="1004" alt="2025-09-17_11h26_44" src="https://github.com/user-attachments/assets/9708f82e-d2a5-4284-9745-06f5029be0f6" />
<img width="1062" height="1004" alt="2025-09-17_11h26_54" src="https://github.com/user-attachments/assets/7d8fb89a-059e-40dc-b572-e2f778b583e8" />

#### 新規作成

1. 役割（Role）を設定（`input/rde-member.txt` でデフォルト指定可能）
2. グループ名・説明、課題番号・研究種別番号を入力
3. **作成** をクリック。※ **一括作成** は現在利用不可（クラッシュします）

#### 修正

1. サブグループを選択（補完検索・表示フィルタ可能）
2. **サブグループ更新** をクリック

   * **RDEサブグループページを開く**: RDE上の同ページを開きます（事前ログイン要）
   * **関連試料抽出**: 所属試料一覧を表示し、クリックでサンプルページを開きます

### 5. データセット

<img width="1062" height="1004" alt="2025-09-17_13h01_58" src="https://github.com/user-attachments/assets/f460aa2c-fdea-4d1c-98d0-8cb4be80b324" />
<img width="1062" height="1004" alt="2025-09-17_13h02_48" src="https://github.com/user-attachments/assets/2efcddbf-8d8d-442f-ab9e-221fa1325702" />
<img width="1062" height="1004" alt="2025-09-17_13h03_26" src="https://github.com/user-attachments/assets/e18f6e21-f6ea-4712-925b-e25afd0d57f5" />

#### 新規開設

1. サブグループを選択（補完検索対応）
2. 課題番号を選択（登録済みであるかは確認）
3. データセット名・エンバーゴ期間終了日を入力
4. テンプレートを持つ
5. 長期シェア・匿名化オプションを選択
6. **データセット開設実行** をクリック

#### 修正

1. データセットを選択（補完検索・表示フィルタ可能）
2. データセット情報を編集

##### 編集可能な項目

```
* データセット吁名
* 課題番号
* 説明（AIサジェスト機能で自動生成・補助が可能）
* エンバーゴ期間終了日
* 問い合わせ先
* タクソノミーキー　（ビルダー使用可能）
* 関連情報
* TAG　（ビルダー使用可能）
* データセット引用の書誌
* 利用ライセンス
* 関連データセット　（検索持参可能）
* データ一覧表示タイプ
* 匿名化・登録削除禁止・長期シェアの吁名プション
```

3. **データセット更新** をクリック

* **RDEデータセットページを開く**: RDE上の同ページを開きます（事前ログイン要）

#### タイル・データエントリー

データセットに含まれるタイル・データエントリーの検索・表示

1. データセットを選択（補完検索・表示フィルタ可能）
2. タイル一覧が表示されます

##### 表示内容

```
* タイル名・説明
* ファイル数・画像数・作成日
* 属性ごとのファイル数（メイン画像、構造化ファイル・非統有RAWデータ・RAWデータ・メタデータ・添付ファイル・サムネイル）
 
```

* **RDEタイルページを開く**: ブラウザ列の「開く」ボタンでRDE上の同ページを開きます（事前ログイン要）

### 6. データ登録

<img width="1062" height="1004" alt="2025-09-17_13h04_57" src="https://github.com/user-attachments/assets/721c7456-86a3-48e8-b72b-98cae744b800" />
<img width="1730" height="1004" alt="2025-09-17_13h06_45" src="https://github.com/user-attachments/assets/f6402182-f7b1-4303-943d-e80cd768683c" />

#### 通常登録

1. データセットを選択（フィルタ・補完検索可能）
2. 試料情報を入力（新規・既存試料選択可能）
3. 固有情報を入力（任意）
4. 基本情報を入力
5. ファイルを選択（データファイル・添付ファイル）
6. **データ登録** をクリック

#### 一括登録

* 持参したディレクトリからファイルセットを定義し、ファイルセットごとに一括してデータファイルを登録することが可能です
* ベースディレクトリを起点にファイルツリーを表示し、複数のファイルセットを指定できます
* 1つのサブディレクトリを複数のファイルセットに配置してアップロード可能です
* 階層ディレクトリのパスをフラット化して1つのファイルセットとしてアップロード可能です
* 容量制限により、自動でファイルセットを分割可能です
* ファイルセット作成方法（プリセット・粒度・単体・最上位フォルダ・個別フォルダ）と、ファイルツリーから任意のフォルダを選択する方法があります
* 動作確認していますが、結構複雑で複雑なので不具合があるかもしれません。問題があればご報告ください

1. ベースディレクトリを選択
2. 作成方法を選択してファイルセットを作成
3. ファイルセットごとに基本情報・試料情報・固有情報を入力
4. ファイルセットごとに設定を適用
5. マッピングファイル作成（任意）
6. **一括登録実行** をクリック

### 7. AI チャット

<img width="1062" height="832" alt="2025-08-22_14h31_56" src="https://github.com/user-attachments/assets/c5dae4c6-b4cb-4341-93bd-45f0381d57bd" />
<img width="1062" height="832" alt="2025-08-22_14h33_31" src="https://github.com/user-attachments/assets/1f58b255-b30d-4623-8f75-d7503e391e32" />

* `input/ai_config.json` と `input/ai/` を準備
* AIプロバイダ・モデルを選択
* 課題番号・実験データを選択
* 利用報告書データの使用有無を選択
* 処理方法を選び **AI処理実行**

> **AI設定ファイルについて**
> 設定は `input/ai_config.json` に記載します。以下が概要です
>
> ```json
> {
>   "ai_providers": {
>     "openai": { "enabled": true, "api_key": "API_KEY_FOR_OPENAI", "base_url": "https://api.openai.com/v1", "models": ["gpt-4o", "gpt-4o-mini", "gpt-4-turbo"], "default_model": "gpt-4o-mini" },
>     "gemini": { "enabled": true, "api_key": "API_KEY_FOR_GEMINI", "base_url": "https://generativelanguage.googleapis.com/v1beta", "models": ["gemini-2.0-flash", "gemini-1.5-pro"], "default_model": "gemini-2.0-flash" },
>     "local_llm": { "enabled": true, "base_url": "http://localhost:11434/api/generate", "models": ["gemma3:12b", "llama3.1:8b"], "default_model": "gemma3:12b" }
>   },
>   "default_provider": "gemini",
>   "timeout": 30,
>   "max_tokens": 1000,
>   "temperature": 0.7
> }
> ```
>
> * OpenAI / Gemini / ローカルLLMの3系統に対応
> * `local_llm` 利用時は **Ollama などのローカルサーバ** が必要です

---


## ✨ 主な特徴

* **RDE操作の自動化**: ログイン、データ検索、ダウンロードなどの操作をGUIで効率化。
* **データポータル連携**: RDEからデータポータルへのデータ移行をスムーズに行うための機能（JSON書誌情報アップロード、画像一括登録など）。
* **AI支援**: OpenAI / Gemini / ローカルLLMに対応し、データセットの説明文作成や品質評価をサポート。
* **一括処理**: 多数のデータセットや画像をまとめて処理可能。
* **プロキシ対応**: 企業や組織のプロキシ環境下でも動作するように設計（設定画面で構成可能）。

---

## ⚠️ 注意事項

* **非公式ツール**: 本ツールは個人開発の非公式ツールです。RDE/データポータル側の仕様変更等により、予告なく動作しなくなる場合があります。
* **権限範囲内動作**: RDE/データポータルの各アカウントに付与された権限範囲内でのみ API 操作を行います。権限外操作は行いません。
* **データ改変リスク**: 実装上の不具合等により、権限範囲内でデータの誤更新・破損が発生する可能性があります。重要データはテスト環境・複製で事前検証した上で利用してください（利用は自己責任）。
* **セキュリティ**: ログイン情報はローカルPC内に保存されます。共用PCでの利用には十分ご注意ください。
* **免責事項**: 本ツールの使用により生じた損害について、開発者は一切の責任を負いません（LGPLv3 の一般的免責範囲に準拠）。
* **企業プロキシ**: 証明書（CA）インポート/Windows証明書ストア経由の検証までをサポートします。SSLインスペクション/高度な透過プロキシ挙動は環境依存のため、社内情報システム部門へ確認してください。
* **対象ユーザー**: 現時点では ARIM データエンジニア / データコーディネーター 等、既に RDE・データポータル双方のアカウントを保有する技術的リテラシーのある利用者を想定しています。

---

## 🤖 AI生成コード利用について

本アプリケーション（本体ソースコード・ドキュメント・一部設定テンプレート等）には、AI支援ツール（大規模言語モデル）を用いて生成・改稿したコード／文章が多数含まれています。

### 取り扱い方針（概要）
* 生成された内容は動作確認・目視確認を基本的に行っていますが、レビューが十分でない箇所が残存する可能性があります。
* AI生成物特有の問題（不必要な冗長性・命名の一貫性欠如・論理の抜け・仕様の曖昧化・ハルシネーションによる誤説明）が含まれる場合があります。
* セキュリティ上の懸念（例: 不適切な例外処理 / 十分でない入力検証）が潜在する可能性があるため、組織導入時は必ずソースコードレビュー・社内基準での検証を行ってください。
* ドキュメント内の技術説明・性能評価は参考情報であり、保証値ではありません。

### 利用者への推奨
| 項目 | 推奨アクション |
|------|----------------|
| 重要ワークフロー導入前 | テスト環境で全主要機能の試験運用 |
| データ登録機能 | 小規模ダミー/検証用データで事前確認 |
| ネットワーク設定 | 企業ポリシー（SSLインスペクション等）との差異確認 |
| AI機能 | 出力文章の事実確認・再編集 |
| セキュリティ | 実行フォルダ/ログのアクセス権限監査 |

改善のため Issue によるフィードバック（欠陥・誤記・危険な処理の指摘）を歓迎します。

---

---

## 🔑 利用前提条件 / アカウント要件

| 区分 | 必要アカウント | 用途 | 補足 |
|------|----------------|------|------|
| RDE機能 | RDEユーザーアカウント | 研究データ取得 / メタ情報参照 / グループ操作 | 付与権限範囲外の操作不可 |
| データポータル連携 | データポータルアカウント | JSON書誌情報アップロード / 画像登録等 | RDE側権限とは独立管理 |
| AI連携（外部LLM） | OpenAI/Gemini等APIキー | 説明文生成 / 分析補助 | APIキーはユーザー自身で取得 |

推奨: まずテスト用データセットで一連の処理（取得/登録/AI補助）を検証した後に本番データへ適用してください。

---

## 🐍 Python / PySide6 対応バージョン

| コンポーネント | 現在の想定サポート | 備考 |
|---------------|--------------------|------|
| Python | 3.11 / 3.12 / 3.13 | 開発環境は 3.13 系で検証。将来 3.14 以降は PySide6 対応状況要確認 |
| PySide6 | 現行リリースが 3.13 まで対応 | 最新対応範囲は公式リリースノートを参照 |
| truststore | Windows 証明書ストア連携 | 企業内 CA をストア登録している場合は自動反映 |

上記は執筆時点の確認であり、将来のバージョン更新で変更される可能性があります。

---

## 📄 ライセンス

本ソフトウェアは **LGPLv3** (GNU Lesser General Public License v3) の下で配布されています。
ソースコードの改変や再配布に関する条件は [LICENSE](LICENSE) ファイルをご確認ください。

---

## 🔗 リンク

* **[変更履歴 (CHANGELOG)](docs/CHANGELOG.md)**
* **[過去のリリースノート](docs/archive/)**
* **[ビルド手順書](docs/binary_build_notes.md)** (開発者向け)
* **[ドキュメント一覧マップ](docs/DOCUMENT_MAP.md)**
* **[リリースノート作成テンプレート](docs/RELEASE_TEMPLATE.md)**
* **[第三者ライセンス通知](THIRD_PARTY_NOTICES/)**

---

## 🔢 バージョン情報

現在配布バージョン: `v2.1.8` （`VERSION.txt` に基づく）

更新履歴の詳細は `docs/CHANGELOG.md` を参照してください。

---

## 🗂 ドキュメント構成ポリシー（概要）

本リポジトリは「バイナリ配布専用」です。ソースコードは将来的に非公開化・凍結される方針であり、公開部分は以下を中心に維持します。

* 利用者向け: `README.md`, 機能別ドキュメント (`docs/features/`)
* 更新履歴: `docs/CHANGELOG.md`, 最新版のリリースノート（直近版のみルート保持）
* アーカイブ: 古いリリースノートは `docs/archive/` に退避
* ライセンス/第三者通知: `LICENSE`, `THIRD_PARTY_NOTICES/`, `docs/archive/MODULE_LICENSES_*.md`

詳細一覧は `docs/DOCUMENT_MAP.md` を参照してください。

---

## 🛡 ライセンス

* ライセンス: **LGPLv3** （`LICENSE`）
* サードパーティライブラリ: `THIRD_PARTY_NOTICES/`, `licenses_index.json`
* 過去版のモジュールライセンス一覧: `docs/archive/MODULE_LICENSES_*.md`

LGPLv3 の要件（再頒布条件等）は https://www.gnu.org/licenses/lgpl-3.0 を参照してください。

---

## 🆘 サポート / 問い合わせ

お問い合わせ・問題報告は **作者（GitHub: https://github.com/MNagasako ）へ直接連絡** してください。公開 Issue も使用できますが、公式サポート体制は存在しません。

報告時推奨情報:
* 利用バージョン (`VERSION.txt` の値)
* Windows バージョン
* 最小再現手順
* 期待結果 / 実際結果

---

## 🔐 セキュリティ / プライバシーの注意（概要）

* 認証情報はローカル PC 上に保持されます（共用端末利用時は注意）。
* 一部データは高速化のためローカルキャッシュされます（必要に応じて手動削除してください）。

---

## ⚙️ 利用時の基本フォルダ

| フォルダ | 用途 |
|----------|------|
| `input/` | 設定ファイル / 操作対象一覧投入 |
| `output/` | 取得結果 / 出力先 |
| `input-sample/` | サンプル設定 / 初期参考ファイル |
| `config/` | ネットワーク等の環境別設定 |

---

## 📦 配布ポリシー変更について

v2.0.0 以降、ライセンス変更（LGPLv3）に伴いソースコードは恒常的公開を行わない方針です。現在の公開分は移行期間中の暫定参照用です。

---

## 🔄 更新手順（概要）

インストーラー版:
1. 新しいセットアップ EXE を取得
2. 旧版アンインストール（任意）
3. 新版インストール

Python 実行版:
```powershell
git pull
./.venv/Scripts/Activate
pip install -r src/requirements.txt --upgrade
python src/arim_rde_tool.py
```

---

