## インストール方法

1. setupファイルのみでインストール可能です。

（ZIP展開や仮想環境・依存パッケージのインストールは不要です）
   - **インストーラー形式（EXE）**: `arim_rde_tool_setup.exe` を実行し、ウィザードに従ってインストール
3. `input/`　`config/` フォルダに設定ファイルやデータを配置
4. GUI画面から各種操作を実施

> 詳細は `input-sample/` および `docs/` を参照してください。
<img width="400" height="400" alt="2025-09-17_12h59_55" src="https://github.com/user-attachments/assets/d63f3c1a-1efb-4bf7-9ed7-8608a8a73c0b" />

> **暫定マニュアル（外部Notion）**
> 最新の操作手順は下記を参照してください（随時更新・作成中）
> [https://cuddly-stinger-40d.notion.site/v2-0-0-2a4fc2cb5fc380978d95fbd07c6fa37e?pvs=74](https://cuddly-stinger-40d.notion.site/v2-0-0-2a4fc2cb5fc380978d95fbd07c6fa37e?pvs=74)


# ARIM RDE Tool v2.1.8

3. アプリで「データポータル」機能を選択
4. 「ログイン設定」タブで本番・テスト環境それぞれの認証情報を入力し保存
5. 接続テストを実行し、成功することを確認

これでデータポータル連携機能が利用可能になります。

**ARIM RDE Tool** は、文部科学省EARIM事業の研究データ共有サイト「RDE」のWeb操作の煩雑さを緩和し、UXを改善する目的で**個人開発**したWindows用デスクトップアプリです。本家RDEサイトの画面・通信動作を観察しながらAPIリクエストを再現しているため、サイト側の仕様変更等により**一部機能が動作しない**場合があります。

本ツールはログイン済みユーザーの**既存権限範囲**でのみ動作し、それを超える操作は行いません。通常の個人利用においてリスクは小さいと考えられますが、RDEサイト側に不具合が存在する場合はその限りではありません。

また、取得可能な情報をローカルにキャッシュして検索・補助機能に利用します。PCユーザーアカウントを他人と共用する場合はご注意ください。※起動時にキャッシュを破棄するオプションは今後提供予定です。

| バージョン | 日付 | 概要 |
| :-----: | :--------: | :------------------------ |
| v2.1.8 | 2025-11-22 | **マイナーアップデート**: AI拡張機能大幅強化（ファイルテキスト自動抽出・使用プロンプト表示・抽出設定永続化） |
| v2.1.7 | 2025-11-22 | **最適化**: テーマ切替最適化完了・不要な再処理除去・配色統一更新 |
| v2.1.6 | 2025-11-17 | **マイナーアップデート**: プロキシ・SSL改善完了・診断ツール体系構築・ネットワークアーキテクチャドキュメント化 |
| v2.1.5 | 2025-11-17 | **マイナーアップデート**: プロジェクト構成整理・PyQt5残滓完全除去・品質改善継続 |
| v2.1.4 | 2025-11-13 | **マイナーアップデート**: バージョン管理統一・ドキュメント更新・品質改善継続（print→logger統一化完了）|
| v2.1.4 | 2025-11-08 | **メジャーアップデート**: PyQt5→PySide6完全移行・LGPLv3へライセンス変更・ソースコード非公開化方針変更・配布方式刷新 |

## 目次

* [主な特徴](#主な特徴)
* [動作環境](#動作環境)
* [ダウンロード](#ダウンロード)
* [インストール](#インストール)
  * [バージョンアップ時の注意](#バージョンアップ時の注意)
  * [初回起動時の警告](#初回起動時の警告)
* [使い方](#使い方)
  * [0. 設定](#0-設定)
  * [1. 基本情報](#1-基本情報)
  * [2. データ取得（旧方式）](#2-データ取得旧方式)
  * [3. データ取得2（新方式）](#3-データ取得2新方式)
  * [4. サブグループ（研究グループ）](#4-サブグループ研究グループ)
  * [5. データセット](#5-データセット)
  * [7. AI チャット](#7-ai-チャット)
* [既知の不具合・注意事項](#既知の不具合注意事項)
* [セキュリティ / プライバシー](#セキュリティ-プライバシー)
* [開発中・ToDo](#開発中todo)
* [主な独自機能 / 非対応・未対応機能](#主な独自機能-非対応未対応機能)
* [Contributing](#contributing)
* [サポート・報告方法](#サポート報告方法)
* [ライセンス](#ライセンス)
* [関連リンク](#関連リンク)
* [開発履歴・バイナリ化と配布](#開発履歴バイナリ化と配布)

---

## 主な特徴

* **v2.1.8新機能**: AI拡張機能大幅強化（データセットファイルからのテキスト自動抽出、使用プロンプト表示、抽出設定永続化）
* **v2.1.7新機能**: テーマ切替最適化完了（配色のみ更新、不要な再処理完全除去）
* **v2.1.6新機能**: プロキシ・SSL処理の品質改善完了、診断ツール体系構築（6種類の診断スクリプト）
* **v2.1.5新機能**: プロジェクト構成整理・PyQt5残滓完全除去・ネットワークアーキテクチャ詳細ドキュメント化
* **v2.1.4新機能**: PyQt5→PySide6完全移行による安定性・UI刷新、LGPLv3ライセンス採用
* **データポータル統合機能**（v2.1.4継承）: JSON書誌情報アップロード、画像一括アップロード、修正機能、ステータス管理
* サブグループ・データセットの一括管理・編集
* AIによる説明文生成・品質評価（OpenAI / Gemini / ローカルLLM対応）
* データセット説明欄AIサジェスト機能（説明文の自動生成・補助、ファイル内容活用）
* RDE情報の一括取得・XLSX出力
* 柔軟なフィルタ・検索・補完機能
* 設定ファイル（JSON/Excel）による柔軟なカスタマイズ

---

## 動作環境

* Windows 10/11 64bit
* バイナリ配布版は Python 不要、実行ファイル単体で動作
* 必要フォルダ（`input/`, `output/`）は初回起動時に自動生成

> **注意（v2.1.6以降）**: PySide6への移行により、PyQt5版と比較して一部のWebView動作やUI描画に細かな差異が生じる可能性があります。動作確認済みですが、特定環境で想定外の挙動が生じた場合はご報告ください

---

## ダウンロード

最新版バイナリは以下より取得できます。
[https://github.com/MNagasako/misc-rde-tool-public/releases](https://github.com/MNagasako/misc-rde-tool-public/releases)

---

> 以降の手順や画面例は一部古い内容が含まれる場合があります。最新の機能・仕様は上記各章を参照してください。

## インストール

1. [Releases](https://github.com/MNagasako/misc-rde-tool-public/releases) から最新版ZIPをダウンロード
2. ZIPを展開し、`arim_rde_tool.exe` を実行
3. `input/` フォルダに設定ファイルやデータを配置
4. GUI画面から各種操作を実施

> 詳細は `input-sample/` および `docs/` を参照してください。

### バージョンアップ時の注意

* `input`・`output` フォルダはそのまま、EXEのみ差し替えでOK
* 保存形式が変わる場合があるため、更新後はあらためて「データ取得・事前準備」を実行してください

### 初回起動時の警告

Windowsのセキュリティ警告やアンチウイルスによりブロックされる場合は、環境に応じて例外設定を行ってください。

<img width="532" height="498" alt="2025-07-31_18h22_53" src="https://github.com/user-attachments/assets/5117baeb-973c-4a7d-aed6-8f2d58400f26" />
<img width="532" height="498" alt="2025-07-31_18h23_02" src="https://github.com/user-attachments/assets/56e2ecce-466c-420e-ba84-95fc0eceacb5" />

## 使い方

### 0. 設定

<img width="1062" height="1004" alt="2025-09-17_11h16_05" src="https://github.com/user-attachments/assets/0991e17a-62aa-461d-bc64-8983c694b384" />
<img width="1062" height="1004" alt="2025-09-17_11h17_17" src="https://github.com/user-attachments/assets/65baed9c-e52e-4cb6-9999-5ac6ad100267" />

* 環境に応じてプロキシ設定を行ってください。通常のブラウザでインターネットアクセスできていれば本ツールも使用可能です（認証付きプロキシは未対応）

> **自動ログイン設定について**
>
> * 「暗号化ファイル」または「OSキーチェーン」への保存を推奨（設定メニューで選択可能）
>
> * `input/login.txt` への平文保存は **非推奨**。やむを得ず利用する場合は以下形式（ICE のみ）
>
>   ```txt
>   username(mail)
>   password
>   dice
>   ```
>
> * login.txt 利用時は毎回警告が表示されます。できるだけ安全な保存方法へ移行してください

> **自動ログイン設定後、アプリを再起動してください。**

### 1. 基本情報

**データ取得・事前準備** <img width="1062" height="925" alt="2025-08-22_13h50_22" src="https://github.com/user-attachments/assets/bb481a4b-3585-409e-bad3-1941694ee20d" />

* RDEサーバ上のデータをローカルに一括取得し、検索機能を有効化します
* 初回は時間を要しますが、既存ファイルはスキップされます
* 強制再取得が必要な場合は対象ファイルを削除して再実行してください
* 初回は20～30分かかる場合があります。短縮したい場合は「基本情報取得（検索用）」で課題番号プリフィックス等により絞り込みを推奨。既存データはスキップされます

1. **基本情報取得（API または 検索用）** を実行
2. **サンプル情報強制取得** を実行
3. **invoice_schema 取得** を実行

### 2. データ取得（旧方式）

* 従来の **WebView** を用いて RDE の画面にアクセスし、BLOB 画像を保存する実装です。パフォーマンス上の制限があり、環境によっては取得に時間がかかります
* 後述の **新方式（API直接ダウンロード）** の利用を推奨します

1. **ARIM課題番号** を指定
2. **実行ボタン** をクリックすると、関連するデータセットと、それに紐付いた **データエントリー（タイル）** の情報を取得します
3. **保存フォルダを開く** ボタンで、保存フォルダを開けます

### 3. データ取得2（新方式）

<img width="1062" height="632" alt="2025-09-17_11h08_48" src="https://github.com/user-attachments/assets/4d1ff881-9c61-4673-acd3-a22f1ca4b1b3" />
<img width="1062" height="632" alt="2025-09-17_11h08_58" src="https://github.com/user-attachments/assets/6865cdfe-dd10-400e-8c0d-30597bb85712" />

* **APIアクセスで直接ダウンロード** する方式です。旧方式に比べて速度の面で有利です
* **データセット単位** でダウンロードします

#### データ取得

1. コンボボックスで対象データセットを選択（フィルタリング・補完検索可能）
2. **選択データセットのファイルを一括取得** をクリックで書誌情報・画像をまとめて取得
3. **出力フォルダ（DataFiles）をエクスプローラーで開く** ボタンで、保存フォルダを開けます

#### ファイルフィルタ

* ファイルタイプ・メディアタイプ・拡張子・サイズ・名称・上限数でダウンロードするファイルを指定できます
* フィルタを指定してからデータ取得タブで一括取得を実行してください

### 4. サブグループ（研究グループ）
<img width="1062" height="1004" alt="2025-09-17_11h26_44" src="https://github.com/user-attachments/assets/9708f82e-d2a5-4284-9745-06f5029be0f6" />
<img width="1062" height="1004" alt="2025-09-17_11h26_54" src="https://github.com/user-attachments/assets/7d8fb89a-059e-40dc-b572-e2f778b583e8" />

#### 新規作成

1. 役割（Role）を設定（`input/rde-member.txt` でデフォルト指定可能）
2. グループ名・説明、課題番号・研究種別番号を入力
3. **作成** をクリック。※ **一括作成** は現在利用不可（クラッシュします）

#### 修正

1. サブグループを選択（補完検索・表示フィルタ可能）
2. **サブグループ更新** をクリック

   * **RDEサブグループページを開く**: RDE上の同ページを開きます（事前ログイン要）
   * **関連試料抽出**: 所属試料一覧を表示し、クリックでサンプルページを開きます

### 5. データセット

<img width="1062" height="1004" alt="2025-09-17_13h01_58" src="https://github.com/user-attachments/assets/f460aa2c-fdea-4d1c-98d0-8cb4be80b324" />
<img width="1062" height="1004" alt="2025-09-17_13h02_48" src="https://github.com/user-attachments/assets/2efcddbf-8d8d-442f-ab9e-221fa1325702" />
<img width="1062" height="1004" alt="2025-09-17_13h03_26" src="https://github.com/user-attachments/assets/e18f6e21-f6ea-4712-925b-e25afd0d57f5" />

#### 新規開設

1. サブグループを選択（補完検索対応）
2. 課題番号を選択（登録済みであるかは確認）
3. データセット名・エンバーゴ期間終了日を入力
4. テンプレートを持つ
5. 長期シェア・匿名化オプションを選択
6. **データセット開設実行** をクリック

#### 修正

1. データセットを選択（補完検索・表示フィルタ可能）
2. データセット情報を編集

##### 編集可能な項目

```
* データセット吁名
* 課題番号
* 説明（AIサジェスト機能で自動生成・補助が可能）
* エンバーゴ期間終了日
* 問い合わせ先
* タクソノミーキー　（ビルダー使用可能）
* 関連情報
* TAG　（ビルダー使用可能）
* データセット引用の書誌
* 利用ライセンス
* 関連データセット　（検索持参可能）
* データ一覧表示タイプ
* 匿名化・登録削除禁止・長期シェアの吁名プション
```

3. **データセット更新** をクリック

* **RDEデータセットページを開く**: RDE上の同ページを開きます（事前ログイン要）

#### タイル・データエントリー

データセットに含まれるタイル・データエントリーの検索・表示

1. データセットを選択（補完検索・表示フィルタ可能）
2. タイル一覧が表示されます

##### 表示内容

```
* タイル名・説明
* ファイル数・画像数・作成日
* 属性ごとのファイル数（メイン画像、構造化ファイル・非統有RAWデータ・RAWデータ・メタデータ・添付ファイル・サムネイル）
 
```

* **RDEタイルページを開く**: ブラウザ列の「開く」ボタンでRDE上の同ページを開きます（事前ログイン要）

### 6. データ登録

<img width="1062" height="1004" alt="2025-09-17_13h04_57" src="https://github.com/user-attachments/assets/721c7456-86a3-48e8-b72b-98cae744b800" />
<img width="1730" height="1004" alt="2025-09-17_13h06_45" src="https://github.com/user-attachments/assets/f6402182-f7b1-4303-943d-e80cd768683c" />

#### 通常登録

1. データセットを選択（フィルタ・補完検索可能）
2. 試料情報を入力（新規・既存試料選択可能）
3. 固有情報を入力（任意）
4. 基本情報を入力
5. ファイルを選択（データファイル・添付ファイル）
6. **データ登録** をクリック

#### 一括登録

* 持参したディレクトリからファイルセットを定義し、ファイルセットごとに一括してデータファイルを登録することが可能です
* ベースディレクトリを起点にファイルツリーを表示し、複数のファイルセットを指定できます
* 1つのサブディレクトリを複数のファイルセットに配置してアップロード可能です
* 階層ディレクトリのパスをフラット化して1つのファイルセットとしてアップロード可能です
* 容量制限により、自動でファイルセットを分割可能です
* ファイルセット作成方法（プリセット・粒度・単体・最上位フォルダ・個別フォルダ）と、ファイルツリーから任意のフォルダを選択する方法があります
* 動作確認していますが、結構複雑で複雑なので不具合があるかもしれません。問題があればご報告ください

1. ベースディレクトリを選択
2. 作成方法を選択してファイルセットを作成
3. ファイルセットごとに基本情報・試料情報・固有情報を入力
4. ファイルセットごとに設定を適用
5. マッピングファイル作成（任意）
6. **一括登録実行** をクリック

### 7. AI チャット

<img width="1062" height="832" alt="2025-08-22_14h31_56" src="https://github.com/user-attachments/assets/c5dae4c6-b4cb-4341-93bd-45f0381d57bd" />
<img width="1062" height="832" alt="2025-08-22_14h33_31" src="https://github.com/user-attachments/assets/1f58b255-b30d-4623-8f75-d7503e391e32" />

* `input/ai_config.json` と `input/ai/` を準備
* AIプロバイダ・モデルを選択
* 課題番号・実験データを選択
* 利用報告書データの使用有無を選択
* 処理方法を選び **AI処理実行**

> **AI設定ファイルについて**
> 設定は `input/ai_config.json` に記載します。以下が概要です
>
> ```json
> {
>   "ai_providers": {
>     "openai": { "enabled": true, "api_key": "API_KEY_FOR_OPENAI", "base_url": "https://api.openai.com/v1", "models": ["gpt-4o", "gpt-4o-mini", "gpt-4-turbo"], "default_model": "gpt-4o-mini" },
>     "gemini": { "enabled": true, "api_key": "API_KEY_FOR_GEMINI", "base_url": "https://generativelanguage.googleapis.com/v1beta", "models": ["gemini-2.0-flash", "gemini-1.5-pro"], "default_model": "gemini-2.0-flash" },
>     "local_llm": { "enabled": true, "base_url": "http://localhost:11434/api/generate", "models": ["gemma3:12b", "llama3.1:8b"], "default_model": "gemma3:12b" }
>   },
>   "default_provider": "gemini",
>   "timeout": 30,
>   "max_tokens": 1000,
>   "temperature": 0.7
> }
> ```
>
> * OpenAI / Gemini / ローカルLLMの3系統に対応
> * `local_llm` 利用時は **Ollama などのローカルサーバ** が必要です

---


## 既知の不具合・注意事項

- **v2.1.6以降での注意**: PySide6への移行により、PyQt5版と比較して一部のWebView動作やUI描画に細かな差異が生じる可能性があります。動作確認済みですが、特定環境で想定外の挙動が生じた場合はご報告ください
- ディスプレイサイズ・解像度により、ウインドウ・文字サイズが意図せず変化する場合があります。開発環境は特定の解像度・DPIでのみ検証しています。他環境ではUI要素の重なり・極小表示等が起きる可能性があります。発生時は **OS / 解像度 / DPI** を添えて問題報告でご連絡ください
- 一括登録・サブグループ編集・AIチャットでまれにUIが固まることがあります。再起動で解消しない場合はご連絡ください
- RDEリンク機能を使用する場合は、事前にブラウザ（Chrome推奨）でRDEへログインしておいてください（Windows/Chromeのみ確認済み）

---

## セキュリティ / プライバシー

* **権限制御**: 本ツールはRDEアカウントで付与されている権限範囲でのみAPI / Web操作を行います。それを超える操作はできません
* **ローカルキャッシュ**: 取得した情報の一部をローカルに保存して検索・補助機能に利用します。PCユーザーアカウントを他人と共用する場合は、キャッシュの扱いにご注意ください。（暫定版で「起動時にキャッシュを破棄」オプションを提供予定）
* **ネットワーク**: プロキシ経由での通信に対応（認証付きプロキシは未対応）。社内ネットワークポリシーに従ってご利用ください
* **リスク認識**: 本ツールはRDEサイト仕様に依存しており、サイト側の変更時に想定外の動作をする可能性があります。重要な操作の前には実際を確認し、必要に応じてブラウザ上で最終確認してください

---


## 開発中・ToDo

- **v2.1.8完了**: AI拡張機能大幅強化（ファイルテキスト自動抽出、使用プロンプト表示、設定永続化）
- **v2.1.7完了**: テーマ切替最適化・パフォーマンス大幅改善
- **v2.1.6完了**: プロキシ・SSL処理改善・診断ツール体系構築
- **v2.1.5完了**: プロジェクト構成整理・PyQt5残滓完全除去
- **v2.1.4完了**: PySide6への完全移行・LGPLv3ライセンス採用
- 今後: 一括登録・サブグループ編集・AI機能の安定性向上継続
- 今後: データセット編集画面のUI・説明文さらなる改善
- 今後: ローカルLLM利用時のエラー通知・プロンプト選択UIの強化
- 今後: AI機能の継続的拡張（プロバイダ追加・プロンプトカスタマイズ性向上）

---

## 主な独自機能 / 非対応・未対応機能

**用語**: **非対応**=意図的に対応しないもの、**未対応**=まだ実装していないもの

### 主な独自機能

* サブグループ：ロールによるフィルタ表示、試料情報抽出、RDE連携
* データセット：タクソノミーキービルダー、TAGビルダー、関連データセットの簡易検索・設定
* データ登録：データセットの簡易指定、補完フィルタ
* RDE情報取得（基本情報）：一括取得、XLSX出力
* AIチャット機能

### 主な非対応機能（意図的に対応しないもの）

* 削除系APIリクエスト（安全性のため未実装、編集ページへのリンクからRDE上で削除）

### 主な未対応機能（今後対応予定）

* データカタログの作成・編集
* 送り状編集（対応予定）
* 添付ファイル削除
* CSVによるグループメンバー一括置換
* 関連試料設定（対応予定）

---

## Contributing

個人開発のため、**Pull Requestは受け付けていません**。バグ・記事ご連絡は、作者に **直接** お知らせください（メール等、把握している連絡手段で構いません）

ご連絡の際に含めていただけると助かる情報

* 事象の概要 / 期待される動作 / 実際の結果
* 再現手順（できれば最小手順）
* 画面キャプチャ・ログ
* 環境情報（OS / 解像度 / DPI / アプリのバージョン）

---

## サポート・報告方法

サポートや不具合報告は、作者に **直接ご連絡** ください。迅速な対応を保証するものではありませんが、可能な範囲で対応します。ドキュメントやコードにはAIによる生成・補助部分があり、誤りが含まれる可能性があります。

---

## ライセンス

本ツールはLGPLv3（GNU Lesser General Public License v3）で配布されています。PySide6の採用に伴うライセンス方針変更とソースコード非公開化に関する方針は本リポジトリのドキュメントをご参照ください。

---

## 関連リンク

* [最新版バイナリ・リリースノート](https://github.com/MNagasako/misc-rde-tool-public/releases)
* [CHANGELOG（詳細な更新履歴）](docs/CHANGELOG.md)
* [AI機能ガイド](docs/AI_FEATURE_GUIDE.md)
* [バイナリビルド手順](docs/binary_build_notes.md)

---

## 開発履歴・バイナリ化と配布

> **注意（v2.1.4以降）**: 本公開リポジトリはバイナリ配布用に移行しました。ソースコードは段階的に非公開化されます（現在は過渡期のため一部残存）。開発者向けビルド手順は開発用リポジトリで管理されており、公開リポジトリでは参考情報として記載しています。

### バイナリ化方法（開発用リポジトリでの手順・参考）

1. **仮想環境の有効化と依存モジュールのインストール**

   ```powershell
   # PowerShell例（開発リポジトリ側での作業）
   cd C:\vscode\rde
   .\.venv\Scripts\Activate.ps1
   pip install -r requirements.txt
   ```

2. **PyInstaller によるバイナリ化（v2.1.4: PySide6版）**

   ```powershell
   pyinstaller --exclude-module pytest --noconsole --onefile --icon "src/image/icon/icon1.ico" --add-data "src/image;image" --add-data "config;config" --add-data "src/js_templates;js_templates" src/arim_rde_tool.py
   ```

* 生成物：`dist/arim_rde_tool.exe`

### 配布連絡

* `arim_rde_tool.exe` … メイン実行ファイル
* `input-sample/` … サンプル入力ファイル群

### ドキュメント

* `README.md` … メイン説明・ダウンロードリンク
* `docs/binary_build_notes.md` … バイナリ配布・使用方法
* `docs/CHANGELOG.md` … 変更履歴
* `docs/RELEASE_NOTES_v*.md` … リリースノート
* `VERSION.txt` … バージョン情報

### 設定・管理

* `.gitignore` … バイナリファイル除外設定
* `rde-public.code-workspace` … VS Code ワークスペース設定
