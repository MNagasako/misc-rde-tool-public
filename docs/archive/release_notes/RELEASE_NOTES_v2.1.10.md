# ARIM RDE Tool v2.1.10 リリースノート

**リリース日**: 2025年11月28日

## 📋 概要

データセット編集機能の大幅改善版。QCompleterによるフィルタ検索からの選択が正しく動作するよう、データセット選択ロジックを完全に刷新しました。

---

## ✨ 新機能

### データセット編集タブ

#### 1. **Completerフィルタ選択の完全対応**
- **問題**: フィルタ検索で絞り込んだデータセットを選択してもフォームに読み込まれない
- **解決**: 2段階検索方式を実装
  - 第1段階: テキスト完全一致検索（高速）
  - 第2段階: IDベース検索（フォールバック）
- **効果**: 直接選択とフィルタ選択で同じデータ取得フローを実現

#### 2. **ID抽出ユーティリティ関数**
- `extract_dataset_id_from_text()` を新規追加
- 正規表現による確実なID抽出（大文字小文字不問）
- 重複ID対応（最初のマッチを返す）

---

## 🐛 バグ修正

### データセット編集

1. **Completer選択時のインデックス検索失敗**
   - **症状**: `findText(Qt.MatchExactly)` が表示テキストの微妙な差異で失敗
   - **修正**: `itemText()` での完全一致検索 → `itemData()` 経由でデータ取得
   - **影響**: フィルタ選択が確実に動作

2. **バッチ登録422エラー対応強化**
   - RDE必須ヘッダー（`Accept: application/vnd.api+json`）を追加
   - フォールバック時も同じヘッダーを送信
   - 詳細エラー情報（URL・ヘッダー・ボディ）をダイアログで表示

3. **ウィジェットテストの互換性修正**
   - `SupportedFileFormatEntry` の `file_ext` → `file_exts` 対応
   - `test_xlsx_supported_formats.py` のアサーション修正

---

## 🧪 テスト

### 新規追加

1. **`test_completer_id_extraction.py`** (8テスト)
   - シンプルID形式
   - RECIPE付き複雑形式
   - ID重複ケース
   - 大文字小文字混在
   - 空白処理

2. **`test_dataset_edit_widget.py`** (3テスト)
   - ウィジェット生成
   - Completer有効化
   - 選択ハンドラー実装

### テスト結果

- **ユニットテスト**: 15 passed ✅
- **ウィジェットテスト**: 22 passed ✅
- **統合テスト**: 全て正常 ✅

---

## 🔧 技術的改善

### アーキテクチャ

1. **責務分離**
   - ID抽出ロジックを独立した関数として実装
   - ユニットテスト可能な設計

2. **デバッグログ強化**
   - INFO/WARNING/ERROR/DEBUGレベルで段階的出力
   - 失敗時は最初の5アイテムの状態をダンプ

3. **正規表現パターン**
   - `ID:\s*([a-f0-9\-]+)` (IGNORECASE)
   - 括弧の有無に関わらず抽出可能

---

## 📝 ドキュメント

### 更新

- リリースノート（本ファイル）
- VERSION.txt
- README.md
- CHANGELOG.md

---

## 🔄 移行ガイド

### 影響範囲

- データセット編集タブのフィルタ検索機能
- 既存の直接選択機能は変更なし（後方互換性維持）

### アップグレード手順

1. 通常通りインストール/起動
2. データセットタブでフィルタ検索を試行
3. 絞り込まれたリストから選択してフォームに正しく読み込まれることを確認

---

## 🐞 既知の問題

なし

---

## 📦 依存関係

変更なし

---

## 👥 貢献者

- MNagasako

---

## 📅 次バージョン予定

- データポータル機能の継続的改善
- UI/UX改善
- パフォーマンス最適化
