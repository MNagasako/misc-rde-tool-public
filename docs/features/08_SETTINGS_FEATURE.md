# 08. 設定機能 - 詳細仕様書

## 概要
ARIM RDE Toolの設定機能は、アプリケーションの動作環境、各種パス設定、UI設定、機能有効化設定等を管理する機能です。ユーザーの使用環境に応じた柔軟なカスタマイズと、設定の永続化・復元機能を提供します。

## 実装ファイル
- **メインロジック**: `src/logic/settings_logic.py`
- **UI制御**: `src/classes/ui_controller.py`
- **設定管理**: `src/classes/settings_manager.py`
- **設定ファイル**: `src/config/app_settings.json`

## 主要機能

### 1. 基本設定
- **アプリケーション設定**: 起動オプション、言語設定
- **パス設定**: 入力・出力ディレクトリのカスタマイズ
- **ログ設定**: ログレベル、出力先の設定
- **バックアップ設定**: 自動バックアップの設定

### 2. UI/UX設定
- **外観設定**: テーマ、フォント、色彩設定
- **レイアウト設定**: ウィンドウサイズ、パネル配置
- **操作設定**: キーボードショートカット、マウス設定
- **表示設定**: 項目表示・非表示の個別設定

### 3. 機能設定
- **AI機能**: AIプロバイダー、API設定
- **データ処理**: 取得上限、フィルタ設定
- **セキュリティ**: 認証方法、暗号化設定
- **連携設定**: 外部システムとの連携設定

### 4. 設定管理
- **プロファイル**: 複数設定プロファイルの管理
- **インポート・エクスポート**: 設定の移行・共有
- **バックアップ・復元**: 設定の安全な保存・復元
- **デフォルト復元**: 初期設定への復元機能

## UI構成

### 設定モード時のレイアウト
```
[設定カテゴリ]          [設定内容]
┌─────────────┐    ┌──────────────────────┐
│ ■ 基本設定    │    │ ■ アプリケーション設定   │
│   - 一般      │    │   起動時動作:           │
│   - パス      │    │   [自動ログイン ▼]      │
│   - ログ      │    │                        │
│               │    │   言語設定:             │
│ ■ UI/UX     │    │   [日本語 ▼]           │
│   - 外観      │    │                        │
│   - レイアウト │    │ ■ ディレクトリ設定      │
│   - 操作      │    │   入力フォルダ:         │
│               │    │   [C:\input] [参照]    │
│ ■ 機能設定    │    │                        │
│   - AI       │    │   出力フォルダ:         │
│   - データ処理 │    │   [C:\output] [参照]   │
│   - セキュリティ│    │                        │
│               │    │ [適用] [リセット] [保存] │
│ ■ 高度な設定  │    │                        │
│   - 開発者    │    └──────────────────────┘
│   - デバッグ  │
└─────────────┘
```

### UIコンポーネントの詳細

#### 1. カテゴリ選択パネル
- **階層表示**: 設定項目のツリー表示
- **検索機能**: 設定項目名での検索
- **お気に入り**: よく使用する設定の登録
- **最近変更**: 最近変更した設定の表示

#### 2. 設定内容パネル
- **動的フォーム**: 設定項目に応じたフォーム生成
- **即時反映**: 変更の即座反映・プレビュー
- **バリデーション**: 設定値の妥当性チェック
- **ヘルプ表示**: 各設定項目の詳細説明

#### 3. 操作ボタン
- **適用**: 変更の一時適用
- **保存**: 設定の永続化
- **リセット**: 変更前の状態に戻す
- **デフォルト**: 初期設定に復元

## 技術仕様

### 1. 設定管理アーキテクチャ
```python
class SettingsManager:
    """設定管理クラス"""
    def __init__(self):
        self.config_file = "config/app_settings.json"
        self.user_config = {}
        self.default_config = {}
    
    def load_settings(self):
        """設定ファイル読み込み"""
        1. デフォルト設定読み込み
        2. ユーザー設定読み込み
        3. 設定マージ処理
        4. バリデーション実行
        
    def save_settings(self):
        """設定ファイル保存"""
        1. 設定値検証
        2. バックアップ作成
        3. ファイル書き込み
        4. 適用処理実行
```

### 2. 設定データ構造
```json
{
  "app_settings": {
    "general": {
      "auto_login": true,
      "language": "ja",
      "startup_mode": "data_fetch",
      "window_state": {
        "width": 1200,
        "height": 800,
        "maximized": false
      }
    },
    "paths": {
      "input_dir": "C:/rde/input",
      "output_dir": "C:/rde/output",
      "temp_dir": "C:/rde/temp",
      "backup_dir": "C:/rde/backup"
    },
    "ui": {
      "theme": "default",
      "font_family": "Yu Gothic UI",
      "font_size": 11,
      "show_tooltips": true,
      "auto_resize": true
    },
    "features": {
      "ai_enabled": true,
      "arim_extension": false,
      "debug_mode": false,
      "advanced_logging": false
    }
  }
}
```

### 3. 設定適用フロー
```python
def apply_settings(self, settings):
    """設定適用処理"""
    1. 設定値バリデーション
    2. 依存関係チェック
    3. UI更新準備
    4. 機能モジュール設定更新
    5. UI反映実行
    6. 完了通知
```

## 基本設定カテゴリ

### 1. 一般設定
- **起動動作**: アプリ起動時の動作設定
- **自動ログイン**: ログイン情報の自動使用
- **言語設定**: UI表示言語の選択
- **更新チェック**: アプリ更新の自動確認

### 2. パス設定
- **入力ディレクトリ**: データ入力元フォルダ
- **出力ディレクトリ**: 結果出力先フォルダ
- **一時ディレクトリ**: 作業用一時フォルダ
- **バックアップディレクトリ**: 自動バックアップ先

### 3. ログ設定
- **ログレベル**: DEBUG、INFO、WARN、ERROR
- **ログ出力先**: ファイル、コンソール、両方
- **ログローテーション**: ファイルサイズ・期間設定
- **ログ保持期間**: 自動削除までの期間

### 4. バックアップ設定
- **自動バックアップ**: 定期バックアップの有効化
- **バックアップ間隔**: 日次、週次、月次
- **保持世代数**: 保持するバックアップ数
- **圧縮設定**: バックアップファイルの圧縮

## UI/UX設定カテゴリ

### 1. 外観設定
- **テーマ**: ライト、ダーク、カスタム
- **フォント**: フォントファミリー・サイズ設定
- **色彩**: アクセントカラー・配色設定
- **アイコン**: アイコンセット・サイズ設定

### 2. レイアウト設定
- **ウィンドウサイズ**: 初期・最大・最小サイズ
- **パネル配置**: 各機能パネルの配置
- **ツールバー**: 表示項目・位置設定
- **ステータスバー**: 表示情報・形式設定

### 3. 操作設定
- **キーボードショートカット**: カスタムショートカット
- **マウス操作**: クリック・ダブルクリック設定
- **ドラッグ&ドロップ**: D&D動作の設定
- **コンテキストメニュー**: 右クリックメニュー設定

### 4. 表示設定
- **ツールチップ**: ヘルプ表示の詳細度
- **プログレス表示**: 進捗表示の詳細レベル
- **確認ダイアログ**: 操作確認の表示頻度
- **通知設定**: 完了・エラー通知の方式

## 機能設定カテゴリ

### 1. AI機能設定
```json
{
  "ai_settings": {
    "enabled": true,
    "default_provider": "OpenAI",
    "providers": [
      {
        "name": "OpenAI",
        "api_key": "sk-...",
        "model": "gpt-4",
        "temperature": 0.7,
        "max_tokens": 2048
      }
    ],
    "prompt_templates": true,
    "conversation_history": 50
  }
}
```

### 2. データ処理設定
- **取得上限**: 画像・データの取得上限数
- **並行処理**: 同時処理数の設定
- **タイムアウト**: 処理タイムアウト時間
- **再試行**: エラー時の再試行回数・間隔

### 3. セキュリティ設定
- **認証方式**: Bearer Token、Cookie認証
- **暗号化**: ローカルデータの暗号化設定
- **アクセス制御**: 機能アクセスの制限設定
- **監査ログ**: 操作履歴の記録設定

### 4. 連携設定
- **外部API**: 外部システムとの連携設定
- **ARIM拡張**: ARIM連携機能の設定
- **Webhook**: イベント通知の設定
- **同期設定**: データ同期の頻度・方式

## 高度な設定

### 1. 開発者設定
- **デバッグモード**: 詳細ログ・エラー情報表示
- **API モック**: テスト用モックAPI使用
- **パフォーマンス監視**: 処理時間測定
- **メモリ監視**: メモリ使用量の監視

### 2. 実験的機能
- **ベータ機能**: 実験段階の機能有効化
- **A/B テスト**: 新機能のテスト参加
- **フィードバック**: 自動フィードバック送信
- **分析データ**: 使用統計の匿名送信

### 3. システム設定
- **プロキシ**: ネットワークプロキシ設定
- **証明書**: SSL証明書の設定
- **キャッシュ**: データキャッシュの設定
- **並行性**: スレッド・プロセス設定

## 設定プロファイル機能

### 1. プロファイル管理
```python
class SettingsProfile:
    """設定プロファイルクラス"""
    def __init__(self, name, description=""):
        self.name = name
        self.description = description
        self.settings = {}
        self.created_at = datetime.now()
    
    def export_profile(self, file_path):
        """プロファイルエクスポート"""
        1. 設定データ収集
        2. 機密情報除去
        3. ファイル形式変換
        4. 暗号化（オプション）
        5. ファイル出力
```

### 2. プロファイル操作
- **作成**: 現在設定からの新規プロファイル作成
- **複製**: 既存プロファイルの複製・編集
- **削除**: 不要プロファイルの削除
- **切替**: アクティブプロファイルの切替

### 3. インポート・エクスポート
- **ファイル形式**: JSON、XML、INI形式対応
- **部分インポート**: 特定カテゴリのみの取り込み
- **マージ**: 既存設定との統合
- **検証**: インポート前の設定検証

## 設定バックアップ・復元

### 1. 自動バックアップ
```python
def create_automatic_backup(self):
    """自動バックアップ作成"""
    1. バックアップタイミング判定
    2. 現在設定の収集
    3. バックアップファイル作成
    4. 古いバックアップの清理
    5. バックアップ履歴更新
```

### 2. 手動バックアップ
- **フルバックアップ**: 全設定の完全バックアップ
- **差分バックアップ**: 変更された設定のみ
- **選択バックアップ**: 指定カテゴリのみ
- **暗号化バックアップ**: パスワード保護バックアップ

### 3. 復元機能
- **ワンクリック復元**: 簡単な復元操作
- **部分復元**: 特定設定のみの復元
- **復元前プレビュー**: 復元内容の事前確認
- **復元取り消し**: 復元操作の取り消し

## エラーハンドリング・検証

### 1. 設定値検証
- **型チェック**: データ型の妥当性確認
- **範囲チェック**: 数値範囲の確認
- **依存関係**: 設定間の依存関係確認
- **フォーマット**: 文字列形式の検証

### 2. 互換性チェック
- **バージョン互換**: 設定形式のバージョン確認
- **機能互換**: 利用可能機能との整合性
- **プラットフォーム互換**: OS・環境との互換性
- **マイグレーション**: 旧設定の自動変換

### 3. エラー処理
- **設定復旧**: 不正設定の自動復旧
- **デフォルト適用**: エラー時のデフォルト値適用
- **警告表示**: 問題設定の警告表示
- **ログ記録**: 設定エラーの詳細記録

## 今後の改善予定

### 1. 機能拡張
- **クラウド同期**: 設定のクラウド同期機能
- **チーム共有**: 組織内での設定共有
- **設定テンプレート**: 用途別設定テンプレート
- **設定推奨**: 使用パターンに基づく推奨設定

### 2. UI/UX改善
- **設定ウィザード**: 初回設定のガイド機能
- **視覚的設定**: ドラッグ&ドロップでの設定
- **プレビュー機能**: 設定変更の即座プレビュー
- **検索強化**: 高度な設定項目検索

### 3. 運用支援
- **設定監査**: 設定の適切性監査
- **パフォーマンス最適化**: 設定による性能最適化提案
- **セキュリティ強化**: セキュリティ設定の強化支援
- **自動最適化**: 使用パターンに基づく自動最適化

---

**更新履歴**
- v1.12.0: UI設定機能の大幅強化、設定プロファイル機能
- v1.11.0: 高度な設定カテゴリの追加
- v1.10.0: 基本的な設定管理機能の実装
