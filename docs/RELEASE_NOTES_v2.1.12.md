# ARIM RDE Tool v2.1.12 リリースノート

リリース日: 2025-12-01

## 概要
v2.1.12 ではデータセット修正タブのUI/UX改善を中心に実施しました。関連データ入力の操作性向上とデータエントリー一覧の視認性改善により、より効率的なデータセット管理を実現しています。

## 主要変更点

### 🎨 データセット修正タブUI改善

#### 1. 関連データセット入力方式の刷新
- **読み取り専用テキストボックス化**: コンボボックス+リスト表示から「選択件数表示+設定ボタン」方式へ変更
- **専用ビルダーダイアログ追加**: `RelatedDatasetsBuilderDialog` 新規実装
  - QComboBoxによる検索可能なデータセット選択
  - QTableWidgetでの選択済みデータセット一覧表示（助成番号/名称/種別表示）
  - **助成番号からの一括追加機能**: 同一助成番号のデータセットをまとめて追加可能
  - 現在編集中のデータセットを自動除外
  - `datasets_changed`シグナルによるリアクティブな更新
- **内部データ管理**: `widget._selected_related_dataset_ids`でIDリスト管理

#### 2. 関連情報入力方式の改善
- **テキストボックス化**: QTextEditからQLineEditへ変更し、設定ボタン経由で編集
- **専用ビルダーダイアログ追加**: `RelatedLinksBuilderDialog` 新規実装
  - タイトル:URL形式のペア管理
  - テーブル形式での編集（追加/削除/編集機能）
  - リアルタイムバリデーション

#### 3. データエントリー一覧テーブル改善
- **列順序修正**: 「登録開始日時」列と「リンク」列の内容が反対になっていた問題を修正
  - 列4: 登録開始日時（日本時間表示）
  - 列5: リンクボタン（「開く」ボタン）
- **日本時間変換機能追加**: `format_start_time_jst()` 関数実装
  - UTC時刻を日本時間（JST: UTC+9時間）に自動変換
  - 表示形式: `YYYY-MM-DD HH:MM:SS`（例: `2024-12-01 19:30:45`）
  - エラー時は元の文字列をそのまま表示

### 🧪 テスト強化

- **新規テスト追加**:
  - `RelatedLinksBuilderDialog`テスト: 4件（全合格）
  - データエントリーテーブル列順序テスト更新: 2件（修正後全合格）
- **既存テスト更新**:
  - `test_dataset_entry_registration_row_split.py`: 列番号変更に対応（列4→列5）
  - `test_dataset_edit_widget.py`: ウィジェット生成テスト全合格（3件）

### 🔧 内部実装改善

- **ペイロード生成ロジック更新**: `create_dataset_update_payload()`のパラメータ変更
  - `selected_datasets_list`引数 → `widget`引数へ変更
  - 内部データ構造`_selected_related_dataset_ids`から直接取得
- **イベントハンドラー配置最適化**: ボタン定義後に即座にイベント接続する構造に修正
- **MagicMock汚染対策**: 継続的な品質保証パターン適用

## テスト結果

### 実行したテストスイート
```
✅ tests/widgets/test_dataset_edit_widget.py: 3/3 passed
✅ tests/unit/test_dataset_entry_registration_row_split.py: 2/2 passed
✅ 日本時間変換関数動作確認: 正常動作
```

### カバレッジ
- 新規機能・修正箇所に対する単体テスト完備
- 既存機能への影響なし（リグレッションテスト全合格）

## 移行ガイド

### データ互換性
- データセット保存形式に変更なし（JSONフォーマット維持）
- 関連データセットIDリストは従来通り保存・読み込み可能

### UI変更
- 関連データセット/関連情報の入力方法が変更されますが、既存データは問題なく表示されます
- 「設定...」ボタンをクリックしてダイアログ経由で編集する新しいワークフローに慣れてください

### 開発者向け
- `create_dataset_update_payload()`の引数が変更されています
- `widget._selected_related_dataset_ids`から関連データセットIDを取得する必要があります

## 既知の課題
- なし（v2.1.11時点の既知問題は再現せず）

## 今後の予定
- データセット開設タブへの同様のUI改善適用を検討中
- データエントリー管理機能のさらなる強化

---
過去リリース詳細は `VERSION.txt` および以前のリリースノートを参照してください。
