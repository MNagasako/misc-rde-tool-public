# ARIM RDE Tool v1.20.0 リリースノート

**リリース日**: 2025年11月7日

## 🎉 新機能

### データポータル統合機能完全実装

v1.20.0では、ARIMデータポータルとの完全統合を実現しました。RDEで作成したデータセットを、シームレスにデータポータルへアップロードし、管理できるようになります。

#### 1. **JSON書誌情報アップロード**
- **機能概要**: RDEで作成したデータセットのJSON書誌情報をデータポータルに登録
- **実装方法**: 
  - ファイル直接選択またはデータセット検索による選択
  - 匿名化オプション（個人情報・ARIM情報の自動除去）
  - テスト環境・本番環境の切り替え対応
- **認証管理**: 
  - 環境別の認証情報保存・自動読込
  - セッション管理・自動再ログイン
  
#### 2. **画像ファイル一括アップロード**
- **機能概要**: データセットに関連する画像ファイルを一括アップロード
- **実装詳細**:
  - JSONアップロード後の自動t_code取得
  - 複数画像の一括選択・アップロード
  - 重複チェック（スキップ/上書き選択可能）
  - プログレス表示・エラーハンドリング
- **フロー**: 
  1. 画像管理画面への遷移
  2. 画像新規登録画面を開く
  3. ファイルアップロード（確認画面へ）
  4. 確定登録

#### 3. **データポータル修正機能**
- **機能概要**: 登録済みエントリの修正・更新
- **実装内容**:
  - エントリ存在チェック（自動ログイン対応）
  - フォーム解析（全フィールドタイプ対応）
  - メタデータベース選択肢の動的取得
  - 2段階保存プロセス（conf→rec）
- **対応フィールド**:
  - ライセンス: ラジオボタン（7種類）
  - 重要技術領域（主）: チェックボックス（最大1つ）
  - 重要技術領域（副）: チェックボックス（最大1つ）
  - 横断技術領域: チェックボックス
  - 設備分類: チェックボックス
  - マテリアルインデックス: チェックボックス
  - タグ: チェックボックス
  - その他: テキスト、日時、セレクトボックス、テキストエリア

#### 4. **ステータス管理機能**
- **機能概要**: 公開/非公開ステータスの切り替え
- **実装詳細**:
  - 現在のステータス自動検出
  - ワンクリックでの切り替え
  - 確認ダイアログ表示
  - ボタンラベルの動的更新
- **ステータス**:
  - 公開済（レベル1-3設定時）
  - 非公開

## 🔧 改善・変更

### UI/UX改善
- **デフォルト選択変更**: データセット検索をデフォルトに変更
- **ラベル削除**: 不要な「データセット選択:」ラベルを削除
- **フィルタ統合**: 広域シェア設定と関係メンバーフィルタを1行に統合
- **ボタン配置最適化**: 修正・ステータス変更ボタンの視認性向上

### アーキテクチャ改善
- **責務分離**: UI・コア・設定・ユーティリティの明確な分離
- **モジュラー設計**: 
  - `core/`: 認証管理、ポータルクライアント、アップローダー
  - `ui/`: データセットアップロードタブ、修正ダイアログ
  - `conf/`: 設定管理
  - `util/`: ユーティリティ関数

### デバッグ機能強化
- **レスポンス保存**: 全APIレスポンスをHTMLファイルとして保存
- **詳細ログ**: 各処理ステップの詳細なログ出力
- **エラートレース**: スタックトレース付きエラーログ

## 📋 技術仕様

### 対応API
- **書誌情報管理**:
  - `mode=theme`: 一覧・検索
  - `mode=theme&mode2=json_upload`: JSONアップロード
  - `mode=theme&mode2=change`: 修正フォーム取得・更新
  - `mode=theme&mode2=open`: ステータス変更
- **画像管理**:
  - `mode=theme&mode2=image`: 画像一覧
  - `mode=theme&mode2=image&mode3=regist`: 画像登録

### 認証方式
- **Basic認証**: arim:パスワード
- **セッション管理**: Cookie（arim_data_session_id）
- **自動再ログイン**: ログインページ検出時の自動処理

### データフォーマット
- **JSON**: UTF-8、RDE標準フォーマット
- **画像**: JPEG/PNG対応
- **フォームエンコーディング**: 
  - JSON: multipart/form-data
  - フォーム: application/x-www-form-urlencoded

## 🐛 バグ修正

### 重要な修正
- **フィールド名修正**: 実際のHTML構造に合わせたフィールド名修正
  - `t_a_code[]` → `main_mita_code_array[]`
  - `t_a_sub_code[]` → `sub_mita_code_array[]`
  - `t_c_code[]` → `mcta_code_array[]`
  - `t_e_code[]` → `t_eqp_code_array[]`
  - `t_m_code[]` → `mi_code_array[]`
  - `t_tag_code[]` → `tag_code_array[]`

- **ラベル抽出改善**: ラジオボタン・チェックボックスのラベル抽出ロジック改善
- **初期表示修正**: データセット検索モードがデフォルトで表示されるように修正

## 📝 ドキュメント更新

- **README.md**: 機能説明・使用方法を更新
- **VERSION.txt**: バージョン履歴を更新
- **アーキテクチャ図**: データポータル統合機能の構成を追加
- **リリースノート**: v1.19.x を archive に移動

## 🔄 移行ガイド

### v1.19.x からのアップグレード
1. **設定ファイル**: 既存の認証情報はそのまま使用可能
2. **データセット**: 既存のデータセットに影響なし
3. **新機能**: データポータルタブが自動的に追加されます

### 初回セットアップ
1. 「ログイン設定」タブで認証情報を保存
2. 「データセットアップロード」タブでデータセットを選択
3. JSONアップロード → 画像アップロードの順で実行

## ⚠️ 既知の問題・制限事項

- **環境制限**: テスト環境・本番環境のみ対応（開発環境非対応）
- **ファイルサイズ**: 大容量画像（10MB以上）はアップロード時間がかかる場合があります
- **ブラウザ依存**: 一部の表示はブラウザのHTMLレンダリングに依存します

## 🙏 謝辞

このリリースは、ユーザーの皆様からのフィードバックを基に開発されました。
ご協力いただいた全ての方々に感謝いたします。

## 📞 サポート

問題が発生した場合は、以下の手順でお問い合わせください：
1. `output/data_portal_debug/` 配下のログファイルを確認
2. エラーメッセージとスクリーンショットを保存
3. 開発チームまでご連絡ください

---

**次のリリース予定**: v1.21.0（データポータルレポート機能）
